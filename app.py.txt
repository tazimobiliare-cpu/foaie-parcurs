import streamlit as st
import pandas as pd
from datetime import datetime
import os

# Configurare paginÄƒ pentru mobil
st.set_page_config(page_title="Foaie Parcurs", page_icon="ğŸš—")

# FiÈ™ierul de stocare
DB_FILE = "foaie_parcurs_2026.csv"

st.title("ğŸš— Foaie de Parcurs")
st.write(f"Data: {datetime.now().strftime('%d-%m-%Y')}")

# FuncÈ›ie salvare
def salveaza_date(data, km_s, traseu, km_f):
    df = pd.DataFrame([[data, km_s, traseu, km_f]], 
                      columns=["Data", "KM Start", "Traseu", "KM Final"])
    if not os.path.isfile(DB_FILE):
        df.to_csv(DB_FILE, index=False)
    else:
        df.to_csv(DB_FILE, mode='a', header=False, index=False)

# InterfaÈ›a
km_s = st.number_input("KM Plecare (Bord)", min_value=0, step=1)
traseu = st.text_input("Traseu (Ex: Str. A > Str. B)")

# Logica de searÄƒ (DupÄƒ ora 17:00)
ora_actuala = datetime.now().hour
km_f = 0
if ora_actuala >= 17:
    st.warning("ğŸŒ™ Este ora Ã®nchiderii. Introdu KM finali:")
    km_f = st.number_input("KM Final (Bord)", min_value=km_s, step=1)

if st.button("âœ… SalveazÄƒ Ã®nregistrarea"):
    if traseu == "":
        st.error("Te rugÄƒm sÄƒ introduci traseul!")
    else:
        data_ora = datetime.now().strftime("%d-%m-%Y %H:%M")
        salveaza_date(data_ora, km_s, traseu, km_f)
        st.success("Salvat cu succes!")

st.divider()

# SecÈ›iune Istoric È™i DescÄƒrcare
if os.path.isfile(DB_FILE):
    df_vizualizare = pd.read_csv(DB_FILE)
    
    with st.expander("Vezi Ã®nregistrÄƒrile lunii"):
        st.dataframe(df_vizualizare)
    
    with open(DB_FILE, "rb") as file:
        st.download_button(
            label="ğŸ“¥ DescarcÄƒ Foaia de Parcurs (CSV)",
            data=file,
            file_name=f"Foaie_Parcurs_{datetime.now().strftime('%m_%Y')}.csv",
            mime="text/csv",
        )
else:
    st.info("Nu existÄƒ Ã®ncÄƒ date salvate pentru luna aceasta.")